@{
    ViewData["Title"] = "Bảng Xếp Hạng Coder";
}

@section Links {
    <style>
        .view-detail {
            cursor: pointer;
            text-decoration: none;
        }

        #sourceCodeEditor {
            width: 100%;
            height: 400px;
            border: 1px solid #ccc;
        }

        #resultContent {
            width: 100%;
            height: 200px;
            resize: vertical;
        }

        .modal-xl {
            max-width: 90%;
        }

        .title {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            width: 100%;
            text-align: center;
            font-weight: 700;
        }

        .avatar-img {
            width: 40px;
            height: 40px;
            object-fit: cover;
            border-radius: 50%;
        }
        .rank{
            padding: 5px 10px;
            cursor: pointer;
        }
    </style>
}

<div id="codepad" class="m-5 flex-center flex-column">
    <h1 class="title text-center">
        <b>BẢNG XẾP HẠNG CODER</b>
    </h1>

    <div class="container mt-3 mb-3 table-responsive list">
        <table id="table-data" class="table table-sm table-hover table-border table-striped ml-5 mr-3">
            <thead>
                <tr class="table-dark">
                    <th></th>
                    <th>Username</th>
                    <th>Họ và Tên</th>
                    <th>Ngôn ngữ</th>
                    <th>Điểm</th>
                    <th>Rank</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

@section Scripts {
    <script src="~/lib/DataTables/datatables.min.js"></script>
    <script>
        $(document).ready(function () {
            var table = $('#table-data').DataTable({
                "processing": true,
                "serverSide": true,
                "searching": true,
                "ajax": {
                    "url": '@Url.Action("_GetRankingList", "Rank")',
                    "data": function (d) {
                        d.keyword = $('input[type="search"]').val();
                    },
                    "type": "POST",
                    "dataSrc": function (json) {
                        return json.data;
                    }
                },
                "pageLength": 10,
                "lengthMenu": [10, 25, 50, 100],
                "order": [[5, "desc"], [4, "desc"]], // Default sort: Rank (col 5) desc, then Point (col 4) desc
                "columns": [
                    {
                        "data": "avatar",
                        "render": function (data, type, row) {
                            return data ? `<a href="/User/Details/${row.id}"><img src="data:image/jpeg;base64,${data}" class="avatar-img" alt="Avatar" /></a>`
                                        : `<a href="/User/Details/${row.id}"><img src="/assets/images/avartardefault.jpg" class="avatar-img" alt="Default Avatar" /></a>`;
                        },
                        "orderable": false // Avatar column is not sortable
                    },
                    { 
                        "data": "username",
                        "render": function (data, type, row) {
                            return `<a href="/User/Details/${row.id}" class="view-detail">${data}</a>`;
                        }
                    },
                    { 
                        "data": "fullname",
                        "render": function (data, type, row) {
                            return `<a href="/User/Details/${row.id}" class="view-detail">${data}</a>`;
                        }
                    },
                    { "data": "programLanguage" },
                    { "data": "point" },
                    { 
                        "data": "rankName",
                        "render": function (data, type, row) {
                            return `<div class="rank ${row.rankCode}">${data}</div>`;
                        }
                    }
                ]
            });


        
        });
         $(document).on('click', '.rank', function() {
                window.location.href = `/rank`;
         });
    </script>
}